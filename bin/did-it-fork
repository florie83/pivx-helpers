#!/bin/bash

# verify that your wallet is still on the main chain

# Example output:
#
#Did it fork?
#      block: 771478
# block hash
#      local: 00f8fec246f7e6e578ce7142d4c59bba9888aeab1918ed98f8e43fe9ee2f178e
#pivxscan.io: 00f8fec246f7e6e578ce7142d4c59bba9888aeab1918ed98f8e43fe9ee2f178e
#       GOOD: still on main

set -e

echo 'Did it fork?'

pivxcli=~/.pivx/pivx-cli

function getBlockNumber() {
  $pivxcli getinfo | grep blocks | sed "s/.*: \([0-9]\+\).*/\1/"
}

function getLocalBlockHash() {
  $pivxcli getblockhash $1
}

function getRemoteBlockHash() {
  curl -s 'http://pivxscan.io/api/getblockhash?index='$1
}

blockNumber=`getBlockNumber`
localBlockHash=`getLocalBlockHash $blockNumber`
remoteBlockHash=`getRemoteBlockHash $blockNumber`

echo '      block: '$blockNumber
echo ' block hash'
echo '      local: '$localBlockHash
echo 'pivxscan.io: '$remoteBlockHash

if [ $localBlockHash == $remoteBlockHash ]; then
  echo '       GOOD: still on main'
else
  echo '        BAD: you are on a fork, got to re-sync'
fi

exit 0
